<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title><%= pageTitle %> | LXH Portfolio</title>
  <link rel="stylesheet" href="/css/style.css" />
</head>
<body>
  <%- include("partials/navbar") %>

  <main class="page">
    <section class="contact-card admin-project-card">
      <h2>Edit Project</h2>

      <% if (error) { %>
        <p class="form-error"><%= error %></p>
      <% } %>

      <!-- ============================
           FORM 1: EDIT PROJECT + CAPTIONS
           ============================ -->
      <form action="/admin/projects/<%= project.project_id %>/edit"
            method="POST"
            class="admin-project-form">

        <!-- Main project fields -->
        <div>
          <label>Project Name</label>
          <input type="text" name="project_name" value="<%= project.project_name %>" required />
        </div>

        <div>
          <label>Short Description</label>
          <textarea name="project_short_description" rows="3" required><%= project.project_short_description %></textarea>
        </div>

        <div>
          <label>Project Type</label>
          <select name="project_type" required>
            <option value="">-- Select type --</option>
            <option value="development" <%= project.project_type === 'development' ? 'selected' : '' %>>Development</option>
            <option value="design" <%= project.project_type === 'design' ? 'selected' : '' %>>Design</option>
          </select>
        </div>

        <hr />

        <h3>Existing Media</h3>
        <p style="font-size: 0.85rem; color: #555;">Update captions for each image/video below.</p>

        <% if (mediaList && mediaList.length > 0) { %>
          <% mediaList.forEach(function(media) { %>
            <div class="media-item">
              <input type="hidden" name="media_id" value="<%= media.media_id %>" />

              <strong>Media #<%= media.sort_order || media.media_id %></strong>

              <div class="project-media-visual" style="margin-top: 0.5rem;">
                <% if (media.media_type === 'image') { %>
                  <img src="<%= media.media_path %>" alt="" style="max-width: 100%; border-radius: 10px;" />
                <% } else if (media.media_type === 'video') { %>
                  <video controls style="max-width: 100%; border-radius: 10px;">
                    <source src="<%= media.media_path %>" />
                  </video>
                <% } else if (media.media_type === 'youtube') { %>
                  <div class="youtube-embed">
                    <a href="<%= media.media_path %>" target="_blank" rel="noopener noreferrer">
                      View YouTube Video
                    </a>
                  </div>
                <% } %>
              </div>

              <label style="margin-top: 0.6rem;">Caption</label>
              <textarea name="media_desc" rows="2"><%= media.media_description || '' %></textarea>
            </div>
          <% }) %>
        <% } else { %>
          <p>No media uploaded yet for this project.</p>
        <% } %>

        <button type="submit" class="btn-send" style="margin-top: 1rem;">
          Save Changes
        </button>
      </form>

      <!-- ============================
           FORM 2: ADD NEW MEDIA
           ============================ -->
      <hr style="margin: 2rem 0;" />

      <h3>Add New Media</h3>
      <p style="font-size: 0.85rem; color: #555;">
        Add a new image, video, or YouTube link for this project.
        If you choose <strong>File</strong>, upload an image/video.
        If you choose <strong>YouTube</strong>, paste the video URL instead.
      </p>

      <form action="/admin/projects/<%= project.project_id %>/media/add"
            method="POST"
            enctype="multipart/form-data"
            class="admin-project-form">

        <div>
          <label>Media Type</label>
          <select name="media_type" required>
            <option value="file">File (image/video)</option>
            <option value="youtube">YouTube Link</option>
          </select>
        </div>

        <div>
          <label>Upload File (for "File" type)</label>
          <input type="file" name="mediaFile" />
        </div>

        <div>
          <label>YouTube URL (for "YouTube" type)</label>
          <input type="text" name="media_youtube" placeholder="https://www.youtube.com/..." />
        </div>

        <div>
          <label>Caption (optional)</label>
          <textarea name="media_desc" rows="2" placeholder="Short description or context for this media"></textarea>
        </div>

        <button type="submit" class="btn-send" style="margin-top: 1rem;">
          Add Media
        </button>
      </form>
    </section>
  </main>

  <%- include("partials/footer") %>
</body>
</html>
