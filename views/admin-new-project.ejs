<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title><%= pageTitle %> | LXH Portfolio</title>
  <link rel="stylesheet" href="/css/style.css" />
</head>
<body>
  <%- include("partials/navbar") %>

  <main class="page">
    <section class="contact-card admin-project-card">
      <h2>Add New Project</h2>

      <% if (error) { %>
        <p class="form-error"><%= error %></p>
      <% } %>

      <!-- IMPORTANT: enctype for file upload -->
      <form
        action="/admin/projects/new"
        method="POST"
        class="admin-project-form"
        enctype="multipart/form-data"
      >
        <div>
          <label>Project Name</label>
          <input type="text" name="project_name" required />
        </div>

        <div>
          <label>Short Description</label>
          <textarea name="project_short_description" rows="3" required></textarea>
        </div>

        <div>
          <label>Project Type</label>
          <select name="project_type" required>
            <option value="">-- Select type --</option>
            <option value="development">Development</option>
            <option value="design">Design</option>
          </select>
        </div>

        <hr />

        <div class="media-section-header">
          <h3>Media Items</h3>
          <p>Add images/videos or YouTube links one by one.</p>
        </div>

        <!-- Dynamic media blocks go here -->
        <div id="media-list"></div>

        <button
          type="button"
          class="btn-add-media"
          onclick="addMediaBlock()"
        >
          + Add Media
        </button>

        <button
          type="submit"
          class="btn-send"
        >
          Save Project
        </button>
      </form>
    </section>
  </main>

  <script>
    let mediaCounter = 0;

    function addMediaBlock() {
      mediaCounter++;

      const list = document.getElementById("media-list");

      const wrapper = document.createElement("div");
      wrapper.className = "media-item";
      wrapper.id = "media_block_" + mediaCounter;

      wrapper.innerHTML = `
        <button
          type="button"
          class="delete-media"
          onclick="removeMediaBlock(${mediaCounter})"
        >
          X
        </button>

        <strong>Media #${mediaCounter}</strong>

        <label style="margin-top: 0.4rem;">Media Type</label>
        <select name="media_type" onchange="toggleMediaInput(${mediaCounter})" required>
          <option value="">-- Select type --</option>
          <option value="file">Upload File</option>
          <option value="youtube">YouTube Link</option>
        </select>

        <!-- File upload -->
        <div id="media_file_${mediaCounter}" style="display:none;">
          <label style="margin-top: 0.4rem;">File</label>
          <input
            type="file"
            name="media_files"
            accept="image/*,video/*"
          />
        </div>

        <!-- YouTube Link -->
        <div id="media_youtube_${mediaCounter}" style="display:none;">
          <label style="margin-top: 0.4rem;">YouTube URL</label>
          <input
            type="text"
            name="media_youtube"
            placeholder="https://youtube.com/watch?v=..."
          />
        </div>

        <label style="margin-top: 0.4rem;">Caption (optional)</label>
        <input
          type="text"
          name="media_desc"
          placeholder="Describe this media"
        />
      `;

      list.appendChild(wrapper);
    }

    function removeMediaBlock(id) {
      const el = document.getElementById("media_block_" + id);
      if (el) el.remove();
    }

    function toggleMediaInput(id) {
      const block = document.getElementById("media_block_" + id);
      if (!block) return;

      const select = block.querySelector('select[name="media_type"]');
      const type = select ? select.value : "";

      const fileDiv = document.getElementById(`media_file_${id}`);
      const youtubeDiv = document.getElementById(`media_youtube_${id}`);

      if (!fileDiv || !youtubeDiv) return;

      const fileInput = fileDiv.querySelector('input[type="file"]');
      const youtubeInput = youtubeDiv.querySelector('input[name="media_youtube"]');

      if (type === "file") {
        fileDiv.style.display = "block";
        youtubeDiv.style.display = "none";

        if (fileInput) fileInput.required = true;
        if (youtubeInput) youtubeInput.required = false;
      } else if (type === "youtube") {
        fileDiv.style.display = "none";
        youtubeDiv.style.display = "block";

        if (fileInput) fileInput.required = false;
        if (youtubeInput) youtubeInput.required = true;
      } else {
        fileDiv.style.display = "none";
        youtubeDiv.style.display = "none";

        if (fileInput) fileInput.required = false;
        if (youtubeInput) youtubeInput.required = false;
      }
    }
  </script>

  <%- include("partials/footer") %>
</body>
</html>
