<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title><%= pageTitle %> | LXH Portfolio</title>
  <link rel="stylesheet" href="/css/style.css" />
</head>

<body>
  <%- include("partials/navbar") %>

  <main class="page project-detail-page">
    <section class="project-detail-header">
      <p class="project-type-pill <%= project.project_type === 'design' ? 'pill-design' : 'pill-dev' %>">
        <%= project.project_type === 'design' ? 'Design Project' : 'Development Project' %>
      </p>

      <h1><%= project.project_name %></h1>

      <p class="project-detail-description">
        <%= project.project_short_description %>
      </p>
    </section>

    <section class="project-detail-media">
      <% if (mediaList && mediaList.length > 0) { %>
        <% mediaList.forEach((media) => { %>
          <% const isCover = project.cover_image && project.cover_image === media.media_path; %>

          <article class="project-media-item">

            <% if (media.media_type === 'image') { %>
              <!-- IMAGE DISPLAY -->
              <div class="project-media-visual">
                <img src="<%= media.media_path %>" 
                     alt="<%= media.media_description || project.project_name %>" />
              </div>

            <% } else if (media.media_type === 'video') { %>
              <!-- VIDEO DISPLAY (Supports YouTube + MP4) -->
              <div class="project-media-visual">

                <% 
                  const isYouTube =
                    media.media_path.includes("youtube.com") ||
                    media.media_path.includes("youtu.be");
                %>

                <% if (isYouTube) { %>
                  <!-- YOUTUBE EMBED -->
                  <div class="video-embed-wrapper">
                    <iframe
                      width="100%"
                      height="400"
                      src="<%= media.media_path
                              .replace('watch?v=', 'embed/')
                              .replace('youtu.be/', 'www.youtube.com/embed/') %>"
                      frameborder="0"
                      allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                      allowfullscreen>
                    </iframe>
                  </div>

                <% } else { %>
                  <!-- NORMAL MP4 VIDEO -->
                  <video controls>
                    <source src="<%= media.media_path %>" />
                    Your browser does not support the video tag.
                  </video>
                <% } %>

              </div>
            <% } %>

            <% if (media.media_description && media.media_description.trim() !== "") { %>
              <p class="project-media-caption">
                <%= media.media_description %>
              </p>
            <% } %>

            <% if (canEdit || isAdmin) { %>
              <div class="project-media-actions">
                <% if (isCover) { %>
                  <span class="cover-badge">Current Cover</span>
                <% } else if (media.media_type === 'image') { %>
                  <form action="/admin/projects/<%= project.project_id %>/set-cover/<%= media.media_id %>"
                        method="POST">
                    <button type="submit" class="btn-outline small-btn">
                      Set as Cover
                    </button>
                  </form>
                <% } %>
              </div>
            <% } %>

          </article>
        <% }) %>
      <% } else { %>
        <p>No media uploaded yet for this project.</p>
      <% } %>
    </section>

    <% if (canEdit || isAdmin) { %>
      <div class="project-admin-actions">
        <a href="/admin/projects/<%= project.project_id %>/edit" class="btn-outline">
          Edit Project
        </a>

        <form action="/admin/projects/<%= project.project_id %>/delete"
              method="POST"
              onsubmit="return confirm('Are you sure you want to delete this project? This cannot be undone.');">
          <button type="submit" class="btn-danger">
            Delete Project
          </button>
        </form>
      </div>
    <% } %>

    <div class="project-detail-back">
      <a href="/projects" class="btn-outline">‚Üê Back to Projects</a>
    </div>
  </main>

  <%- include("partials/footer") %>
</body>

</html>
